$.coDesign=$.coDesign||{};$.coDesign.brushes=$.coDesign.brushes||{};$.coDesign.brushes.webby={name:"Webby",len:20,randomizePoints:!0,points:10,layers:10,randomizeSpin:!0,spin:180,connectLines:!0,size:{wave:0.5,min:0.1,max:1},pressure:{max:2,randomize:!1,softness:0.3}};$.coDesign.brushes.sketchy={name:"Sketchy",len:50,randomizePoints:!0,points:2,layers:20,randomizeSpin:!1,spin:45,connectLines:!0,size:{wave:0.9,min:0.1,max:2},pressure:{min:2,max:3,wave:0.2,randomize:!0,softness:0.5}};
$.coDesign.brushes.spray={name:"Spray","default":!1,len:10,randomizePoints:!0,randomizeSpin:!0,spin:360,points:5,layers:70,connectLines:!1,pressure:{softness:0}};$.coDesign.brushes.solid={name:"Solid","default":!0,len:1,randomizePoints:!1,points:40,layers:15,connectLines:!0,pressure:{softness:0}};$.coDesign=$.coDesign||{};$.coDesign.colors=$.coDesign.colors||{};$.coDesign.colors.chalk={name:"Chalk",image:"color/chalk.png",frequencyR:0.1,frequencyG:0.1,frequencyB:0.1,phaseR:0.1,phaseG:0.1,phaseB:0.1,center:127,width:80,len:50};$.coDesign.colors.chrome={name:"Chrome",image:"color/chrome.png",frequencyR:0.1,frequencyG:0.1,frequencyB:0.1,phaseR:0,phaseG:1,phaseB:2,center:80,width:127,len:50};
$.coDesign.colors.rainbow={name:"Rainbow",image:"color/rainbow.png",frequencyR:0.1,frequencyG:0.1,frequencyB:0.1,phaseR:0,phaseG:2,phaseB:4,center:128,width:127,len:50};(function(c){function b(a){var b=g({brushes:a.brushes,colors:a.colors,defaultBrush:a.defaultBrush.realName,defaultSize:1,sizes:a.sizes});c(b).appendTo(a.$context);c("body").mousedown(function(d){if(d.which!==1)return!0;a.$brushDropdown.hide();a.$colorDropdown.hide();a.$sizeDropdown.hide();a.$saveDropdown.hide();a.$modal.hide()});a.$modal=c("#codesign-modal");a.$brushDropdown=c("#codesign-brushes");a.$brushButton=c("#codesign-selected-brush");a.$colorDropdown=c("#codesign-colors");a.$colorButton=c("#codesign-selected-color");
a.$sizeDropdown=c("#codesign-sizes");a.$sizeButton=c("#codesign-selected-size");a.$saveDropdown=c("#codesign-save");a.$saveButton=c("#codesign-save-button");a.$image=c("#codesign-image");e(a.$brushDropdown,a.$brushButton,a);e(a.$colorDropdown,a.$colorButton,a);e(a.$sizeDropdown,a.$sizeButton,a);e(a.$saveDropdown,a.$saveButton,a);a.$colorPicker=c("#codesign-color-picker");a.$colorButton.css({borderColor:a.defaultColor});a.currentColor=a.defaultColor;a.currentBrush=a.currentBrush;c.farbtastic(a.$colorPicker).setColor(a.defaultColor).linkTo(function(h){a.currentColor=
h;d(a);a.$selectedColor&&(a.$selectedColor.removeClass("active"),l(a));a.$eraseButton.addClass("disabled");a.$colorButton.css({borderColor:h})});a.$colorDropdown.find("button").mousedown(function(){var h=c(this),b=h.data("name");a.$selectedColor&&(a.$selectedColor.removeClass("active"),l(a));a.$selectedColor=h.addClass("active");a.$colorButton.removeClass("disabled");a.$eraseButton.addClass("disabled");a.$colorButton.css({borderColor:"transparent"}).addClass("codesign-color-"+b);a.currentColor=a.colors[b];
d(a)});a.$brushDropdown.find("button").mousedown(function(){var b=c(this),g=b.data("name");a.$selectedBrush&&a.$selectedBrush.removeClass("active");a.$brushButton.removeClass("codesign-brush-"+a.defaultBrush.realName);a.$selectedBrush&&a.$brushButton.removeClass("codesign-brush-"+a.$selectedBrush.data("name"));a.$selectedBrush=b.addClass("active");a.$brushButton.addClass("codesign-brush-"+g);a.currentBrush=a.brushes[g];d(a)});a.$eraseButton=c("#codesign-eraser").tipsy({gravity:"nw"}).mousedown(function(){a.$eraseButton.hasClass("disabled")?
(a.painter.updateColor("#fff"),a.painter.updateBrush({len:1,randomizePoints:!1,randomizeSpin:!1,spin:45,points:70,layers:10,connectLines:!0,pressure:{softness:0}}),a.$eraseButton.removeClass("disabled")):d(a)});a.$saveButton.mousedown(function(){var d=a.canvas.toDataURL("image/jpeg");a.$image.attr("src",d)});a.$image.mousedown(function(){return!1});a.$sizeDropdown.find("button").mousedown(function(){var d=c(this),b=d.data("value");a.$selectedSize&&(a.$selectedSize.removeClass("active"),a.$sizeButton.removeClass("codesign-size-"+
a.$selectedSize.data("value")));a.$selectedSize=d.addClass("active");a.$sizeButton.addClass("codesign-size-"+b);a.writer.fontSize=b<10?16:b<20?24:b<40?32:48;a.painter.size=b;a.painter.updateBrush()})}function e(a,d,b){d.tipsy({gravity:"nw"}).bind("mouseup mousedown",function(a){a.stopPropagation()}).click(function(c){d.position();b.$colorDropdown.get(0)!==a.get(0)&&b.$colorDropdown.hide();b.$brushDropdown.get(0)!==a.get(0)&&b.$brushDropdown.hide();b.$sizeDropdown.get(0)!==a.get(0)&&b.$sizeDropdown.hide();
b.$saveDropdown.get(0)!==a.get(0)&&b.$saveDropdown.hide();a.css("display")==="block"?b.$modal.hide():b.$modal.show();a.toggle();c.stopPropagation()})}function d(a){a.$eraseButton.addClass("disabled");a.painter.updateColor(a.currentColor);a.writer.updateColor(a.currentColor);a.painter.updateBrush(a.currentBrush)}function l(a){a.$selectedColor&&a.$colorButton.removeClass("codesign-color-"+a.$selectedColor.data("name"))}function m(a,d){var b=!/\W/.test(a)?q[a]=q[a]||m(document.getElementById(a).innerHTML):
new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+a.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return d?b(d):b}var g=m('<div class="codesign-modal" id="codesign-modal" style="display:none;"></div><div class="codesign-control"><button data-name="save" id="codesign-save-button" title="Open in new window as image" class="codesign-save last"></button><button id="codesign-selected-size" title="Choose a brush size" class="codesign-size-<%=defaultSize%>"></button><button id="codesign-selected-brush" title="Select a brush" class="codesign-brush-<%=defaultBrush%>"></button><button id="codesign-selected-color" title="What color would you like?"></button></div><div class="codesign-dropdown" id="codesign-brushes" style="display:none"><% for (var i in brushes) { %><% if(brushes.hasOwnProperty(i)) { %><button data-name="<%=i%>" class="button"><span class="codesign-brush-<%=i%>">&nbsp;</span><%=brushes[i].name%></button><%} %><%} %></div><div class="codesign-dropdown" id="codesign-colors" style="display:none"><div class="codesign-left-col"><div id="codesign-color-picker"></div><span class="codesign-middle-text">or</span></div><div class="codesign-right-col"><% for (var i in colors) { %><% if(colors.hasOwnProperty(i)) { %><button data-name="<%=i%>" class="button"><span class="codesign-color-<%=i%>">&nbsp;</span><%=colors[i].name%></button><%} %><%} %></div></div><div class="codesign-dropdown" id="codesign-sizes" style="display:none"><button data-value="1" class="button"><span class="codesign-size-1">&nbsp;</span>Small</button><button data-value="16" class="button"><span class="codesign-size-16">&nbsp;</span>Medium</button><button data-value="32" class="button last"><span class="codesign-size-32">&nbsp;</span>Large</button></div><div class="codesign-dropdown" id="codesign-save" style="display:none"><div class="codesign-image"><img src="" id="codesign-image" /></div><p class="codesign-save-message">To save, right click on the above image, and then select "Save Image As".</p></div>');
c.coDesign.CanvasControl=function(a){this.painter=a.painter;this.writer=a.writer;this.brushes=a.brushes||{};this.colors=a.colors||{};this.sizes=a.sizes||[1,16,32];this.$context=a.$context;this.canvas=a.canvas;this.defaultColor=a.defaultColor||"#900";this.defaultBrush=a.defaultBrush||{};b(this)};c.coDesign.CanvasControl.prototype={};var q={}})(jQuery);(function(){function c(d,c){if(c.brush&&c.color){var m=d.canvas.getContext("2d"),g=c.brush,e=c.x,a=c.y,j=g.size,h=g.pointsPerLayer,o=g.spin,f=g.layers>=j?j:g.layers,n=Math.floor(j/f)||1;m.lineWidth=g.lineWidth;m.strokeStyle=typeof c.color==="string"?c.color:"rgba("+c.color.r+","+c.color.g+","+c.color.b+","+(g.pressure.softness||1)+")";m.beginPath();do b({centerX:e,centerY:a,radiusX:j*g.heightRatio,radiusY:j*g.widthRatio,spin:g.randomizeSpin?Math.floor(Math.random()*(g.spinDegree+1))/360:o,steps:g.randomizePoints?
Math.floor(Math.random()*h+1):h,layers:f,drawMethod:function(a,b,c){var e=g.connectLines!==!1,h={};if(g.pressure.randomize)m.lineWidth=Math.floor(Math.random()*(g.lineWidth+1));d.points[f]||(d.points[f]=[]);!d.points[f][a]||!e?(h.x=b-1,h.y=c-1):(h.x=d.points[f][a].x,h.y=d.points[f][a].y);d.points[f][a]={x:b,y:c};m.moveTo(h.x,h.y);m.lineTo(b,c)}}),j-=n,f--;while(f);m.stroke()}}function b(d){var b=d.centerX,c=d.centerY,g=d.radiusX,e=d.radiusY,a=d.steps,j=d.drawMethod,h,o,f,n;h=d.spin*2*Math.PI;var d=
Math.sin(h),p=Math.cos(h);o=b+p*g;f=c+d*e;for(h=1;h<=a;h++)o=h/a*2*Math.PI,f=Math.sin(o),n=Math.cos(o),o=b+(g*n*p-e*f*d),f=c+(g*n*d+e*f*p),j(h,o,f)}var e=1;$.coDesign.CanvasDraw=function(d){this.id=e++;this.canvas=d.canvas;this.size=d.size;this.updateColor(d.color||{});this.updateBrush(d.brush||{});this.erase=this.isActive=!1;this.points=[]};$.coDesign.CanvasDraw.prototype={begin:function(){this.isActive=!0;return this},complete:function(){this.isActive=!1;this.points=[];return this},draw:function(d){var b,
e;if(!this.isActive)return this;if(this.erase)return this.canvas.getContext("2d").clearRect(d.x-this.size/2,d.y-this.size/2,this.size,this.size),this;this.color=b=d.color||(!this.colors?this.color:this.colors.next());if(!(e=d.brush))this.brushReverse?this.brushCyclePos===0?(e=1,this.brushReverse=!1):(e=-1,this.brushReverse=!0):this.brushCyclePos===this.brushLength?(e=-1,this.brushReverse=!0):(e=1,this.brushReverse=!1),e=this.brushes[this.brushCyclePos+=e];d={x:d.x,y:d.y,color:b,brush:e};this.brush=
e;c(this,d);return this},updateColor:function(b){typeof b==="string"?(this.colorOptions={},this.color=b,this.colors=null):(this.colorOptions=b||{},this.colors=new $.coDesign.ColorArray(this.colorOptions))},updateBrush:function(b){if(b)this.brushOptions=b;for(var b=this.brushOptions,c=this.size,e=0,g=b.len||4,q=b.spin/360||20/360,a=b.points||7,j=b.layers||4,h=b.size||{max:0.5,min:null,wave:null},o=Math.ceil(c*(h.min||0.1)),f=Math.ceil(c*(h.max||0.1)),n=b.pressure||{max:4,min:2,wave:0.3},p=[],k,r;e++<
g;)k=h.wave&&o?Math.ceil(Math.sin(h.wave*e)*o+f):c,r=n.wave&&n.max?Math.sin(n.wave*e)*n.max+n.min:n.max||2,p.push({layers:j,pointsPerLayer:a,lineWidth:r,size:k,spinDegree:b.spin,spin:q,widthRatio:b.widthRatio||1,heightRatio:b.heightRatio||1,radiusOpts:h,pressure:n,connectLines:b.connectLines,randomizeSpin:b.randomizeSpin,randomizePoints:b.randomizePoints});this.brushes=p;this.brushLength=this.brushes.length;this.brushCyclePos=0;this.brushReverse=!1},setErase:function(b){this.erase=b===void 0?!0:b}}})();(function(){function c(b){return typeof b==="string"?b:(b=b.next(),"rgba("+b.r+","+b.g+","+b.b+",.8)")}$.coDesign.CanvasWrite=function(b){this.canvas=b.canvas;this.fontStyle="bold";this.fontSize=b.fontSize||16;this.fontFamily="sans-serif";this.baseline="top";this.color=b.color||"#fff";this.colorString="#fff";this.align="left";this.left=this.top=0;this.lastCharacters=[]};$.coDesign.CanvasWrite.prototype={begin:function(b){var e=this.canvas.getContext("2d");this.lastCharacters=[];this.top=b.top;this.left=
this.beginLeft=b.left;this.color=b.color||this.color;this.colorString=typeof this.color==="string"?this.color:c(this.color);e.textBaseline="middle";e.globalAlpha=0.9},draw:function(b){var e=this.canvas.getContext("2d"),d=b.value,l=e.measureText(d).width,m;try{m=e.getImageData(this.left,this.top-this.fontSize/2,l,this.fontSize)}catch(g){}this.lastCharacters.push({top:this.top,left:this.left,height:this.fontSize,width:l,imageData:m});e.font=this.fontStyle+" "+(b.size||this.fontSize)+"px "+this.fontFamily;
e.fillStyle=b.color||c(this.color);this.colorString=e.fillStyle;e.fillText(d,this.left,this.top);this.left+=l},backspace:function(){var b=this.canvas.getContext("2d"),c;if(this.lastCharacters.length!==0){c=this.lastCharacters.pop();try{b.putImageData(c.imageData,c.left,c.top-c.height/2)}catch(d){}this.left-=c.width}},newline:function(){this.top+=this.fontSize;this.left=this.beginLeft},updateColor:function(b){typeof b==="string"?this.color=b:(this.color=new $.coDesign.ColorArray(b),this.colorString=
c(new $.coDesign.ColorArray(b)))}}})();(function(){function c(b){var c=b.frequencyR||0.1,d=b.frequencyG||0.1,l=b.frequencyB||0.1,m=b.phaseR||0.1,g=b.phaseG||0.1,q=b.phaseB||0.1,a=b.alpha||0.3,j=b.center||200,h=b.width||100,b=b.len||50,o=[],f,n,p,k;for(k=0;++k<b;)f=Math.sin(c*k+m)*h+j,n=Math.sin(d*k+g)*h+j,p=Math.sin(l*k+q)*h+j,o.push({r:Math.floor(f),g:Math.floor(n),b:Math.floor(p),a:a});return o}$.coDesign.ColorArray=function(b){var e=c(b),d=0,l=!1,m=e.length;e.next=function(){var b;l?d===0?(b=1,l=!1):(b=-1,l=!0):d===m-1?(b=-1,l=!0):
(b=1,l=!1);return e[d+=b]};return e}})();(function(c){var b={},e={},d={brushes:c.coDesign.brushes,colors:c.coDesign.colors,color:"#b33",brushSize:2,height:null,width:null,fullScreen:!1,onDraw:function(){},onWrite:function(){},enableControls:!0};c.fn.coDesign=function(l,m){return this.each(function(){var g=c(this),q,a,j,h,o;if(typeof l==="string")return g.trigger({type:l+".codesign",options:m}),!0;if(c.data(this,"IsCoDesign"))return g.trigger({type:"update.codesign",options:l}),!0;var f=c.extend({},d,l||{}),n=f.width||g.width(),p=f.fullScreen?
c(window).height():f.height||g.height(),k=c('<canvas tabindex="1" class="codesign-canvas" width="'+n+'" height="'+p+'" />').appendTo(g);if(!k.get(0).getContext||!k.get(0).getContext("2d"))return alert("coDesign.js will not work for you.  Your browser does not support HTML5 canvas.  Please consider upgrading your browser."),!1;var r=g.position(),s=[],t=k.offset(),i={init:function(){var b=k.get(0).getContext("2d");b.fillStyle="#fff";b.fillRect(0,0,n,p);k.mousedown(function(a){a.preventDefault()});o=
i.getDefault(f.brushes);a=new c.coDesign.CanvasDraw({canvas:k.get(0),color:f.color,size:f.brushSize,brush:c.extend({},o)||{}});j=new c.coDesign.CanvasWrite({canvas:k.get(0),color:f.color});k.get(0).onkeypress=i.textareaKeyUp;f.enableControls&&i.enableControls();i.bindCoDesignEvents();c.data(g.get(0),"IsCoDesign",!0)},textareaKeyUp:function(a){var b;b=a.which;a=String.fromCharCode(b);b===8?(b="backspace",j.backspace()):b===13?(b="newline",j.newline()):(b="complete",j.draw({value:a}));f.onWrite({action:b,
value:a,color:j.colorString,size:j.fontSize})},enableControls:function(){new c.coDesign.CanvasControl({canvas:k.get(0),brushes:f.brushes,colors:f.colors,painter:a,writer:j,$context:g,defaultColor:f.color,defaultBrush:o})},mouseUp:function(b){var c=b.clientY+window.pageYOffset-r.top,d=b.clientX+window.pageXOffset-r.left;b.preventDefault();j.begin({top:c,left:d});f.onWrite({action:"begin",top:c,left:d,color:j.colorString,size:j.fontSize});clearInterval(q);a.complete();f.onDraw({type:"push-paint",action:"complete"})},
mouseDown:function(b){var c=b.clientX+window.pageXOffset-r.left,d=b.clientY+window.pageYOffset-r.top;b.preventDefault();k.focus();a.begin();f.onDraw({type:"push-paint",action:"begin"});q=setInterval(function(){a.draw({x:c,y:d});if(a.brush&&a.color)f.onDraw({action:"incomplete",brush:a.brush,color:a.color,x:c,y:d})},300)},mouseMove:function(b){b.preventDefault();if(a.isActive){var c=b.clientX+window.pageXOffset-r.left,b=b.clientY+window.pageYOffset-r.top;clearInterval(q);a.draw({x:c,y:b});if(a.isActive&&
a.brush&&a.color)f.onDraw({action:"incomplete",brush:a.brush,color:a.color,x:c,y:b})}},touchUp:function(b){b.preventDefault();a.complete();f.onDraw({type:"push-paint",action:"complete"})},touchDown:function(b){b.preventDefault();c.each(b.touches,function(a,b){s[b.identifier]={x:this.pageX-t.left,y:this.pageY-t.top}});k.focus();a.begin();f.onDraw({type:"push-paint",action:"begin"})},touchMove:function(b){b.preventDefault();a.isActive&&c.each(b.touches,function(b,c){var d=c.identifier,e=this.pageX-
t.left-s[d].x,g=this.pageY-t.top-s[d].y;a.draw({x:s[b].x,y:s[b].y});if(a.isActive&&a.brush&&a.color)f.onDraw({action:"incomplete",brush:a.brush,color:a.color,x:x,y:y});s[d].x=s[b].x+e;s[d].y=s[b].y+g})},paint:function(a){var a=a.options,b=a.action,d=a.clientId,f;b&&d&&((f=e[d])||(f=e[d]=new c.coDesign.CanvasDraw({canvas:k.get(0)})),b==="begin"?f.begin(a):b==="complete"?f.complete():b==="incomplete"&&f.draw({color:a.color,x:a.x,y:a.y,brush:a.brush}))},write:function(a){var a=a.options,d=a.action,f=
a.clientId,e;d&&f&&((e=b[f])||(e=b[f]=new c.coDesign.CanvasWrite({canvas:k.get(0)})),d==="begin"?e.begin({top:a.top,left:a.left,color:a.color,size:a.size}):d==="complete"?e.draw({value:a.value,color:a.color,size:a.size}):d==="newline"?e.newline():d==="backspace"&&e.backspace())},onBodyMouseDown:function(){h=!0},onBodyMouseUp:function(){h=!1},destroy:function(){c(document.body).unbind("mousedown",i.onBodyMouseDown).unbind("mouseup",i.onBodyMouseUp);g.empty();g.unbind("paint.codesign",i.paint).unbind("write.codesign",
i.write).unbind("update.codesign",i.update).unbind("destroy.codesign",i.destroy);c.data(this,"IsCoDesign",!1);delete i},update:function(a){c.extend(f,a.options||{})},clear:function(){var a=k.get(0);a.getContext("2d").clearRect(0,0,a.width,a.height)},bindCoDesignEvents:function(){var a=k.get(0);c(document.body).bind("mousedown",i.onBodyMouseDown).bind("mouseup",i.onBodyMouseUp);k.bind("mouseleave",function(a){i.mouseUp(a)}).bind("mouseenter",function(a){h&&(!a.fromElement||a.fromElement.tagName!==
"BUTTON")&&i.mouseDown(a)}).bind("mouseup",i.mouseUp).bind("mousedown",i.mouseDown).bind("mousemove",i.mouseMove);a.addEventListener("touchstart",i.touchDown,!1);a.addEventListener("touchmove",i.touchMove,!1);a.addEventListener("touchend",i.touchUp,!1);g.bind("paint.codesign",i.paint).bind("write.codesign",i.write).bind("update.codesign",i.update).bind("destroy.codesign",i.destroy).bind("clear.codesign",i.clear)},getDefault:function(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b]["default"])return a[b].realName=
b,a[b]}};i.init()})}})(jQuery);

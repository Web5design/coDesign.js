$.coDesign=$.coDesign||{};$.coDesign.brushes=$.coDesign.brushes||{};$.coDesign.brushes.webby={name:"Webby",len:20,randomizePoints:!0,points:10,layers:10,randomizeSpin:!0,spin:180,connectLines:!0,size:{wave:0.5,min:0.1,max:1},pressure:{max:2,randomize:!1,softness:0.3}};$.coDesign.brushes.sketchy={name:"Sketchy",len:50,randomizePoints:!0,points:2,layers:20,randomizeSpin:!1,spin:45,connectLines:!0,size:{wave:0.9,min:0.1,max:2},pressure:{min:2,max:3,wave:0.2,randomize:!0,softness:0.5}};
$.coDesign.brushes.spray={name:"Spray","default":!1,len:10,randomizePoints:!0,randomizeSpin:!0,spin:360,points:5,layers:70,connectLines:!1,pressure:{softness:0}};$.coDesign.brushes.solid={name:"Solid","default":!0,len:1,randomizePoints:!1,points:40,layers:15,connectLines:!0,pressure:{softness:0}};$.coDesign=$.coDesign||{};$.coDesign.colors=$.coDesign.colors||{};$.coDesign.colors.chalk={name:"Chalk",image:"color/chalk.png",frequencyR:0.1,frequencyG:0.1,frequencyB:0.1,phaseR:0.1,phaseG:0.1,phaseB:0.1,center:127,width:80,len:50};$.coDesign.colors.chrome={name:"Chrome",image:"color/chrome.png",frequencyR:0.1,frequencyG:0.1,frequencyB:0.1,phaseR:0,phaseG:1,phaseB:2,center:80,width:127,len:50};
$.coDesign.colors.rainbow={name:"Rainbow",image:"color/rainbow.png",frequencyR:0.1,frequencyG:0.1,frequencyB:0.1,phaseR:0,phaseG:2,phaseB:4,center:128,width:127,len:50};(function(c){function a(b){var a=d({brushes:b.brushes,colors:b.colors,defaultBrush:b.defaultBrush.realName,defaultSize:1,sizes:b.sizes});c(a).appendTo(b.$context);c("body").mousedown(function(g){if(g.which!==1)return!0;b.$brushDropdown.hide();b.$colorDropdown.hide();b.$sizeDropdown.hide();b.$saveDropdown.hide();b.$modal.hide()});b.$modal=c("#codesign-modal");b.$brushDropdown=c("#codesign-brushes");b.$brushButton=c("#codesign-selected-brush");b.$colorDropdown=c("#codesign-colors");b.$colorButton=c("#codesign-selected-color");
b.$sizeDropdown=c("#codesign-sizes");b.$sizeButton=c("#codesign-selected-size");b.$saveDropdown=c("#codesign-save");b.$saveButton=c("#codesign-save-button");b.$image=c("#codesign-image");f(b.$brushDropdown,b.$brushButton,b);f(b.$colorDropdown,b.$colorButton,b);f(b.$sizeDropdown,b.$sizeButton,b);f(b.$saveDropdown,b.$saveButton,b);b.$colorPicker=c("#codesign-color-picker");b.$colorButton.css({borderColor:b.defaultColor});b.currentColor=b.defaultColor;b.currentBrush=b.currentBrush;c.farbtastic(b.$colorPicker).setColor(b.defaultColor).linkTo(function(a){b.currentColor=
a;g(b);b.$selectedColor&&(b.$selectedColor.removeClass("active"),l(b));b.$eraseButton.addClass("disabled");b.$colorButton.css({borderColor:a})});b.$colorDropdown.find("button").mousedown(function(){var a=c(this),d=a.data("name");b.$selectedColor&&(b.$selectedColor.removeClass("active"),l(b));b.$selectedColor=a.addClass("active");b.$colorButton.removeClass("disabled");b.$eraseButton.addClass("disabled");b.$colorButton.css({borderColor:"transparent"}).addClass("codesign-color-"+d);b.currentColor=b.colors[d];
g(b)});b.$brushDropdown.find("button").mousedown(function(){var a=c(this),d=a.data("name");b.$selectedBrush&&b.$selectedBrush.removeClass("active");b.$brushButton.removeClass("codesign-brush-"+b.defaultBrush.realName);b.$selectedBrush&&b.$brushButton.removeClass("codesign-brush-"+b.$selectedBrush.data("name"));b.$selectedBrush=a.addClass("active");b.$brushButton.addClass("codesign-brush-"+d);b.currentBrush=b.brushes[d];g(b)});b.$eraseButton=c("#codesign-eraser").tipsy({gravity:"nw"}).mousedown(function(){b.$eraseButton.hasClass("disabled")?
(b.painter.updateColor("#fff"),b.painter.updateBrush({len:1,randomizePoints:!1,randomizeSpin:!1,spin:45,points:70,layers:10,connectLines:!0,pressure:{softness:0}}),b.$eraseButton.removeClass("disabled")):g(b)});b.$saveButton.mousedown(function(){var g=b.canvas.toDataURL("image/jpeg");b.$image.attr("src",g)});b.$image.mousedown(function(){return!1});b.$sizeDropdown.find("button").mousedown(function(){var g=c(this),a=g.data("value");b.$selectedSize&&(b.$selectedSize.removeClass("active"),b.$sizeButton.removeClass("codesign-size-"+
b.$selectedSize.data("value")));b.$selectedSize=g.addClass("active");b.$sizeButton.addClass("codesign-size-"+a);b.writer.fontSize=a<10?16:a<20?24:a<40?32:48;b.painter.size=a;b.painter.updateBrush()})}function f(b,g,a){g.tipsy({gravity:"nw"}).bind("mouseup mousedown",function(b){b.stopPropagation()}).click(function(c){g.position();a.$colorDropdown.get(0)!==b.get(0)&&a.$colorDropdown.hide();a.$brushDropdown.get(0)!==b.get(0)&&a.$brushDropdown.hide();a.$sizeDropdown.get(0)!==b.get(0)&&a.$sizeDropdown.hide();
a.$saveDropdown.get(0)!==b.get(0)&&a.$saveDropdown.hide();b.css("display")==="block"?a.$modal.hide():a.$modal.show();b.toggle();c.stopPropagation()})}function g(b){b.$eraseButton.addClass("disabled");b.painter.updateColor(b.currentColor);b.writer.updateColor(b.currentColor);b.painter.updateBrush(b.currentBrush)}function l(b){b.$selectedColor&&b.$colorButton.removeClass("codesign-color-"+b.$selectedColor.data("name"))}function h(b,g){var a=!/\W/.test(b)?p[b]=p[b]||h(document.getElementById(b).innerHTML):
new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+b.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return g?a(g):a}var d=h('<div class="codesign-modal" id="codesign-modal" style="display:none;"></div><div class="codesign-control"><button data-name="save" id="codesign-save-button" title="Open in new window as image" class="codesign-save last"></button><button id="codesign-selected-size" title="Choose a brush size" class="codesign-size-<%=defaultSize%>"></button><button id="codesign-selected-brush" title="Select a brush" class="codesign-brush-<%=defaultBrush%>"></button><button id="codesign-selected-color" title="What color would you like?"></button></div><div class="codesign-dropdown" id="codesign-brushes" style="display:none"><% for (var i in brushes) { %><% if(brushes.hasOwnProperty(i)) { %><button data-name="<%=i%>" class="button"><span class="codesign-brush-<%=i%>">&nbsp;</span><%=brushes[i].name%></button><%} %><%} %></div><div class="codesign-dropdown" id="codesign-colors" style="display:none"><div class="codesign-left-col"><div id="codesign-color-picker"></div><span class="codesign-middle-text">or</span></div><div class="codesign-right-col"><% for (var i in colors) { %><% if(colors.hasOwnProperty(i)) { %><button data-name="<%=i%>" class="button"><span class="codesign-color-<%=i%>">&nbsp;</span><%=colors[i].name%></button><%} %><%} %></div></div><div class="codesign-dropdown" id="codesign-sizes" style="display:none"><button data-value="1" class="button"><span class="codesign-size-1">&nbsp;</span>Small</button><button data-value="16" class="button"><span class="codesign-size-16">&nbsp;</span>Medium</button><button data-value="32" class="button last"><span class="codesign-size-32">&nbsp;</span>Large</button></div><div class="codesign-dropdown" id="codesign-save" style="display:none"><div class="codesign-image"><img src="" id="codesign-image" /></div><p class="codesign-save-message">To save, right click on the above image, and then select "Save Image As".</p></div>');
c.coDesign.CanvasControl=function(b){this.painter=b.painter;this.writer=b.writer;this.brushes=b.brushes||{};this.colors=b.colors||{};this.sizes=b.sizes||[1,16,32];this.$context=b.$context;this.canvas=b.canvas;this.defaultColor=b.defaultColor||"#900";this.defaultBrush=b.defaultBrush||{};a(this)};c.coDesign.CanvasControl.prototype={};var p={}})(jQuery);(function(){function c(g,c){if(c.brush&&c.color){var h=g.canvas.getContext("2d"),d=c.brush,f=c.x,b=c.y,j=d.size,k=d.pointsPerLayer,o=d.spin,e=d.layers>=j?j:d.layers,n=Math.floor(j/e)||1;h.lineWidth=d.lineWidth;h.strokeStyle=typeof c.color==="string"?c.color:"rgba("+c.color.r+","+c.color.g+","+c.color.b+","+(d.pressure.softness||1)+")";h.beginPath();do a({centerX:f,centerY:b,radiusX:j*d.heightRatio,radiusY:j*d.widthRatio,spin:d.randomizeSpin?Math.floor(Math.random()*(d.spinDegree+1))/360:o,steps:d.randomizePoints?
Math.floor(Math.random()*k+1):k,layers:e,drawMethod:function(b,a,c){var f=d.connectLines!==!1,l={};if(d.pressure.randomize)h.lineWidth=Math.floor(Math.random()*(d.lineWidth+1));g.points[e]||(g.points[e]=[]);!g.points[e][b]||!f?(l.x=a-1,l.y=c-1):(l.x=g.points[e][b].x,l.y=g.points[e][b].y);g.points[e][b]={x:a,y:c};h.moveTo(l.x,l.y);h.lineTo(a,c)}}),j-=n,e--;while(e);h.stroke()}}function a(a){var c=a.centerX,f=a.centerY,d=a.radiusX,p=a.radiusY,b=a.steps,j=a.drawMethod,k,o,e,n;k=a.spin*2*Math.PI;var a=
Math.sin(k),q=Math.cos(k);o=c+q*d;e=f+a*p;for(k=1;k<=b;k++)o=k/b*2*Math.PI,e=Math.sin(o),n=Math.cos(o),o=c+(d*n*q-p*e*a),e=f+(d*n*a+p*e*q),j(k,o,e)}var f=1;$.coDesign.CanvasDraw=function(a){this.id=f++;this.canvas=a.canvas;this.size=a.size;this.updateColor(a.color||{});this.updateBrush(a.brush||{});this.erase=this.isActive=!1;this.points=[]};$.coDesign.CanvasDraw.prototype={begin:function(){this.isActive=!0;return this},complete:function(){this.isActive=!1;this.points=[];return this},draw:function(a){var f,
h;if(!this.isActive)return this;if(this.erase)return this.canvas.getContext("2d").clearRect(a.x-this.size/2,a.y-this.size/2,this.size,this.size),this;this.color=f=a.color||(!this.colors?this.color:this.colors.next());if(!(h=a.brush))this.brushReverse?this.brushCyclePos===0?(h=1,this.brushReverse=!1):(h=-1,this.brushReverse=!0):this.brushCyclePos===this.brushLength?(h=-1,this.brushReverse=!0):(h=1,this.brushReverse=!1),h=this.brushes[this.brushCyclePos+=h];a={x:a.x,y:a.y,color:f,brush:h};this.brush=
h;c(this,a);return this},updateColor:function(a){typeof a==="string"?(this.colorOptions={},this.color=a,this.colors=null):(this.colorOptions=a||{},this.colors=new $.coDesign.ColorArray(this.colorOptions))},updateBrush:function(a){if(a)this.brushOptions=a;for(var a=this.brushOptions,c=this.size,f=0,d=a.len||4,p=a.spin/360||20/360,b=a.points||7,j=a.layers||4,k=a.size||{max:0.5,min:null,wave:null},o=Math.ceil(c*(k.min||0.1)),e=Math.ceil(c*(k.max||0.1)),n=a.pressure||{max:4,min:2,wave:0.3},q=[],m,r;f++<
d;)m=k.wave&&o?Math.ceil(Math.sin(k.wave*f)*o+e):c,r=n.wave&&n.max?Math.sin(n.wave*f)*n.max+n.min:n.max||2,q.push({layers:j,pointsPerLayer:b,lineWidth:r,size:m,spinDegree:a.spin,spin:p,widthRatio:a.widthRatio||1,heightRatio:a.heightRatio||1,radiusOpts:k,pressure:n,connectLines:a.connectLines,randomizeSpin:a.randomizeSpin,randomizePoints:a.randomizePoints});this.brushes=q;this.brushLength=this.brushes.length;this.brushCyclePos=0;this.brushReverse=!1},setErase:function(a){this.erase=a===void 0?!0:a}}})();(function(){function c(a){return typeof a==="string"?a:(a=a.next(),"rgba("+a.r+","+a.g+","+a.b+",.8)")}$.coDesign.CanvasWrite=function(a){this.canvas=a.canvas;this.fontStyle="bold";this.fontSize=a.fontSize||16;this.fontFamily="sans-serif";this.baseline="top";this.color=a.color||"#fff";this.colorString="#fff";this.align="left";this.left=this.top=0;this.lastCharacters=[]};$.coDesign.CanvasWrite.prototype={begin:function(a){var f=this.canvas.getContext("2d");this.lastCharacters=[];this.top=a.top;this.left=
this.beginLeft=a.left;this.color=a.color||this.color;this.colorString=typeof this.color==="string"?this.color:c(this.color);f.textBaseline="middle";f.globalAlpha=0.9},draw:function(a){var f=this.canvas.getContext("2d"),g=a.value,l;f.font=this.fontStyle+" "+(a.size||this.fontSize)+"px "+this.fontFamily;f.fillStyle=a.color||c(this.color);a=f.measureText(g).width;try{l=f.getImageData(this.left,this.top-this.fontSize/2,a,this.fontSize)}catch(h){}this.lastCharacters.push({top:this.top,left:this.left,height:this.fontSize,
width:a,imageData:l});this.colorString=f.fillStyle;f.fillText(g,this.left,this.top);this.left+=a},backspace:function(){var a=this.canvas.getContext("2d"),c;if(this.lastCharacters.length!==0){c=this.lastCharacters.pop();try{a.putImageData(c.imageData,c.left,c.top-c.height/2)}catch(g){}this.left-=c.width}},newline:function(){this.top+=this.fontSize;this.left=this.beginLeft},updateColor:function(a){typeof a==="string"?this.color=a:(this.color=new $.coDesign.ColorArray(a),this.colorString=c(new $.coDesign.ColorArray(a)))}}})();(function(){function c(a){var c=a.frequencyR||0.1,g=a.frequencyG||0.1,l=a.frequencyB||0.1,h=a.phaseR||0.1,d=a.phaseG||0.1,p=a.phaseB||0.1,b=a.alpha||0.3,j=a.center||200,k=a.width||100,a=a.len||50,o=[],e,n,q,m;for(m=0;++m<a;)e=Math.sin(c*m+h)*k+j,n=Math.sin(g*m+d)*k+j,q=Math.sin(l*m+p)*k+j,o.push({r:Math.floor(e),g:Math.floor(n),b:Math.floor(q),a:b});return o}$.coDesign.ColorArray=function(a){var f=c(a),g=0,l=!1,h=f.length;f.next=function(){var a;l?g===0?(a=1,l=!1):(a=-1,l=!0):g===h-1?(a=-1,l=!0):
(a=1,l=!1);return f[g+=a]};return f}})();(function(c){var a={},f={},g={brushes:c.coDesign.brushes,colors:c.coDesign.colors,color:"#b33",brushSize:2,height:null,width:null,fullScreen:!1,onDraw:function(){},onWrite:function(){},enableControls:!0};c.fn.coDesign=function(l,h){return this.each(function(){var d=c(this),p,b,j,k,o;if(typeof l==="string")return d.trigger({type:l+".codesign",options:h}),!0;if(c.data(this,"IsCoDesign"))return d.trigger({type:"update.codesign",options:l}),!0;var e=c.extend({},g,l||{}),n=e.width||d.width(),q=e.fullScreen?
c(window).height():e.height||d.height(),m=c('<canvas tabindex="1" class="codesign-canvas" width="'+n+'" height="'+q+'" />').appendTo(d);if(!m.get(0).getContext||!m.get(0).getContext("2d"))return alert("coDesign.js will not work for you.  Your browser does not support HTML5 canvas.  Please consider upgrading your browser."),!1;var r=d.position(),s=[],t=m.offset(),i={init:function(){var a=m.get(0).getContext("2d");a.fillStyle="#fff";a.fillRect(0,0,n,q);m.mousedown(function(b){b.preventDefault()});o=
i.getDefault(e.brushes);b=new c.coDesign.CanvasDraw({canvas:m.get(0),color:e.color,size:e.brushSize,brush:c.extend({},o)||{}});j=new c.coDesign.CanvasWrite({canvas:m.get(0),color:e.color});m.get(0).onkeypress=i.textareaKeyUp;e.enableControls&&i.enableControls();i.bindCoDesignEvents();c.data(d.get(0),"IsCoDesign",!0)},textareaKeyUp:function(b){var a;a=b.which;b=String.fromCharCode(a);a===8?(a="backspace",j.backspace()):a===13?(a="newline",j.newline()):(a="complete",j.draw({value:b}));e.onWrite({action:a,
value:b,color:j.colorString,size:j.fontSize});return!1},enableControls:function(){new c.coDesign.CanvasControl({canvas:m.get(0),brushes:e.brushes,colors:e.colors,painter:b,writer:j,$context:d,defaultColor:e.color,defaultBrush:o})},mouseUp:function(a){var c=a.clientY+window.pageYOffset-r.top,d=a.clientX+window.pageXOffset-r.left;a.preventDefault();j.begin({top:c,left:d});e.onWrite({action:"begin",top:c,left:d,color:j.colorString,size:j.fontSize});clearInterval(p);b.complete();e.onDraw({action:"complete"})},
mouseDown:function(a){var c=a.clientX+window.pageXOffset-r.left,d=a.clientY+window.pageYOffset-r.top;a.preventDefault();m.focus();b.begin();e.onDraw({action:"begin"});p=setInterval(function(){b.draw({x:c,y:d});if(b.brush&&b.color)e.onDraw({action:"incomplete",brush:b.brush,color:b.color,left:c,top:d})},300)},mouseMove:function(a){a.preventDefault();if(b.isActive){var c=a.clientX+window.pageXOffset-r.left,a=a.clientY+window.pageYOffset-r.top;clearInterval(p);b.draw({x:c,y:a});if(b.isActive&&b.brush&&
b.color)e.onDraw({action:"incomplete",brush:b.brush,color:b.color,left:c,top:a})}},touchUp:function(a){a.preventDefault();b.complete();e.onDraw({action:"complete"})},touchDown:function(a){a.preventDefault();c.each(a.touches,function(b,a){s[a.identifier]={x:this.pageX-t.left,y:this.pageY-t.top}});m.focus();b.begin();e.onDraw({action:"begin"})},touchMove:function(a){a.preventDefault();b.isActive&&c.each(a.touches,function(a,c){var d=c.identifier,f=this.pageX-t.left-s[d].x,g=this.pageY-t.top-s[d].y;
b.draw({x:s[a].x,y:s[a].y});if(b.isActive&&b.brush&&b.color)e.onDraw({action:"incomplete",brush:b.brush,color:b.color,left:x,top:y});s[d].x=s[a].x+f;s[d].y=s[a].y+g})},paint:function(a){var a=a.options,b=a.action,d=a.clientId,e;b&&d&&((e=f[d])||(e=f[d]=new c.coDesign.CanvasDraw({canvas:m.get(0)})),b==="begin"?e.begin(a):b==="complete"?e.complete():b==="incomplete"&&e.draw({color:a.color,x:a.left,y:a.top,brush:a.brush}))},write:function(b){var b=b.options,d=b.action,e=b.clientId,f;d&&e&&((f=a[e])||
(f=a[e]=new c.coDesign.CanvasWrite({canvas:m.get(0)})),d==="begin"?f.begin({top:b.top,left:b.left,color:b.color,size:b.size}):d==="complete"?f.draw({value:b.value,color:b.color,size:b.size}):d==="newline"?f.newline():d==="backspace"&&f.backspace())},onBodyMouseDown:function(){k=!0},onBodyMouseUp:function(){k=!1},destroy:function(){c(document.body).unbind("mousedown",i.onBodyMouseDown).unbind("mouseup",i.onBodyMouseUp);d.empty();d.unbind("paint.codesign",i.paint).unbind("write.codesign",i.write).unbind("update.codesign",
i.update).unbind("destroy.codesign",i.destroy);c.data(this,"IsCoDesign",!1);delete i},update:function(a){c.extend(e,a.options||{})},clear:function(){var a=m.get(0);a.getContext("2d").clearRect(0,0,a.width,a.height)},bindCoDesignEvents:function(){var a=m.get(0);c(document.body).bind("mousedown",i.onBodyMouseDown).bind("mouseup",i.onBodyMouseUp);m.bind("mouseleave",function(a){i.mouseUp(a)}).bind("mouseenter",function(a){k&&(!a.fromElement||a.fromElement.tagName!=="BUTTON")&&i.mouseDown(a)}).bind("mouseup",
i.mouseUp).bind("mousedown",i.mouseDown).bind("mousemove",i.mouseMove);a.addEventListener("touchstart",i.touchDown,!1);a.addEventListener("touchmove",i.touchMove,!1);a.addEventListener("touchend",i.touchUp,!1);d.bind("paint.codesign",i.paint).bind("write.codesign",i.write).bind("update.codesign",i.update).bind("destroy.codesign",i.destroy).bind("clear.codesign",i.clear)},getDefault:function(a){for(var b in a)if(a.hasOwnProperty(b)&&a[b]["default"])return a[b].realName=b,a[b]}};i.init()})}})(jQuery);

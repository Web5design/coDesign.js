$.coDesign=$.coDesign||{};$.coDesign.brushes=$.coDesign.brushes||{};$.coDesign.brushes.webby={name:"Webby",len:20,randomizePoints:!0,points:10,layers:10,randomizeSpin:!0,spin:180,connectLines:!0,size:{wave:0.5,min:0.1,max:1},pressure:{max:2,randomize:!1,softness:0.3}};$.coDesign.brushes.sketchy={name:"Sketchy",len:50,randomizePoints:!0,points:2,layers:20,randomizeSpin:!1,spin:45,connectLines:!0,size:{wave:0.9,min:0.1,max:2},pressure:{min:2,max:3,wave:0.2,randomize:!0,softness:0.5}};
$.coDesign.brushes.spray={name:"Spray","default":!1,len:10,randomizePoints:!0,randomizeSpin:!0,spin:360,points:5,layers:70,connectLines:!1,pressure:{softness:0}};$.coDesign.brushes.solid={name:"Solid","default":!0,len:10,randomizePoints:!1,points:70,layers:10,connectLines:!0,pressure:{softness:0}};$.coDesign=$.coDesign||{};$.coDesign.colors=$.coDesign.colors||{};$.coDesign.colors.chalk={name:"Chalk",image:"color/chalk.png",frequencyR:0.1,frequencyG:0.1,frequencyB:0.1,phaseR:0.1,phaseG:0.1,phaseB:0.1,center:127,width:80,len:50};$.coDesign.colors.chrome={name:"Chrome",image:"color/chrome.png",frequencyR:0.1,frequencyG:0.1,frequencyB:0.1,phaseR:0,phaseG:1,phaseB:2,center:80,width:127,len:50};
$.coDesign.colors.rainbow={name:"Rainbow",image:"color/rainbow.png",frequencyR:0.1,frequencyG:0.1,frequencyB:0.1,phaseR:0,phaseG:2,phaseB:4,center:128,width:127,len:50};(function(b){function e(a){var d=i({brushes:a.brushes,colors:a.colors,defaultBrush:a.defaultBrush.realName,defaultSize:1,sizes:a.sizes});b(d).appendTo(a.$context);b("body").mousedown(function(c){if(c.which!==1)return!0;a.$brushDropdown.hide();a.$colorDropdown.hide();a.$sizeDropdown.hide();a.$saveDropdown.hide();a.$modal.hide()});a.$modal=b("#codesign-modal");a.$brushDropdown=b("#codesign-brushes");a.$brushButton=b("#codesign-selected-brush");a.$colorDropdown=b("#codesign-colors");a.$colorButton=b("#codesign-selected-color");
a.$sizeDropdown=b("#codesign-sizes");a.$sizeButton=b("#codesign-selected-size");a.$saveDropdown=b("#codesign-save");a.$saveButton=b("#codesign-save-button");a.$image=b("#codesign-image");g(a.$brushDropdown,a.$brushButton,a);g(a.$colorDropdown,a.$colorButton,a);g(a.$sizeDropdown,a.$sizeButton,a);g(a.$saveDropdown,a.$saveButton,a);a.$colorPicker=b("#codesign-color-picker");a.$colorButton.css({borderColor:a.defaultColor});a.currentColor=a.defaultColor;b.farbtastic(a.$colorPicker).setColor(a.defaultColor).linkTo(function(b){a.currentColor=
b;a.painter.updateColor(b);a.writer.updateColor(b);a.$selectedColor&&(a.$selectedColor.removeClass("active"),c(a));a.$eraseButton.addClass("disabled");a.$colorButton.css({borderColor:b})});a.$colorDropdown.find("button").mousedown(function(){var q=b(this),d=q.data("name");a.$selectedColor&&(a.$selectedColor.removeClass("active"),c(a));a.$selectedColor=q.addClass("active");a.$colorButton.removeClass("disabled");a.$eraseButton.addClass("disabled");a.$colorButton.css({borderColor:"transparent"}).addClass("codesign-color-"+
d);a.currentColor=a.colors[d];a.writer.updateColor(a.currentColor);a.painter.updateColor(a.currentColor)});a.$brushDropdown.find("button").mousedown(function(){var c=b(this),d=c.data("name");a.$selectedBrush&&a.$selectedBrush.removeClass("active");a.$brushButton.removeClass("codesign-brush-"+a.defaultBrush.realName);a.$selectedBrush&&a.$brushButton.removeClass("codesign-brush-"+a.$selectedBrush.data("name"));a.$selectedBrush=c.addClass("active");a.$brushButton.addClass("codesign-brush-"+d);a.painter.updateBrush(a.brushes[d])});
a.$eraseButton=b("#codesign-eraser").tipsy({gravity:"nw"}).mousedown(function(){a.$eraseButton.hasClass("disabled")?(a.painter.updateColor("#fff"),a.$eraseButton.removeClass("disabled")):(a.painter.updateColor(a.currentColor),a.$eraseButton.addClass("disabled"))});a.$saveButton.mousedown(function(){var c=a.canvas.toDataURL("image/jpeg");a.$image.attr("src",c)});a.$image.mousedown(function(){return!1});a.$sizeDropdown.find("button").mousedown(function(){var c=b(this),d=c.data("value");a.$selectedSize&&
(a.$selectedSize.removeClass("active"),a.$sizeButton.removeClass("codesign-size-"+a.$selectedSize.data("value")));a.$selectedSize=c.addClass("active");a.$sizeButton.addClass("codesign-size-"+d);a.writer.fontSize=d<10?16:d<20?24:d<40?32:48;a.painter.size=d;a.painter.updateBrush()})}function g(a,c,b){c.tipsy({gravity:"nw"}).bind("mouseup mousedown",function(a){a.stopPropagation()}).click(function(d){c.position();b.$colorDropdown.get(0)!==a.get(0)&&b.$colorDropdown.hide();b.$brushDropdown.get(0)!==a.get(0)&&
b.$brushDropdown.hide();b.$sizeDropdown.get(0)!==a.get(0)&&b.$sizeDropdown.hide();b.$saveDropdown.get(0)!==a.get(0)&&b.$saveDropdown.hide();a.css("display")==="block"?b.$modal.hide():b.$modal.show();a.toggle();d.stopPropagation()})}function c(a){a.$selectedColor&&a.$colorButton.removeClass("codesign-color-"+a.$selectedColor.data("name"))}function o(a,c){var b=!/\W/.test(a)?d[a]=d[a]||o(document.getElementById(a).innerHTML):new Function("obj","var p=[],print=function(){p.push.apply(p,arguments);};with(obj){p.push('"+
a.replace(/[\r\t\n]/g," ").split("<%").join("\t").replace(/((^|%>)[^\t]*)'/g,"$1\r").replace(/\t=(.*?)%>/g,"',$1,'").split("\t").join("');").split("%>").join("p.push('").split("\r").join("\\'")+"');}return p.join('');");return c?b(c):b}var i=o('<div class="codesign-modal" id="codesign-modal" style="display:none;"></div><div class="codesign-control"><button id="codesign-selected-brush" title="Select a brush" class="codesign-brush-<%=defaultBrush%>"></button><button id="codesign-selected-size" title="Choose a brush size" class="codesign-size-<%=defaultSize%>"></button><button id="codesign-selected-color" title="What color would you like?"></button><button data-name="eraser" id="codesign-eraser" title="Click to use eraser" class="codesign-eraser disabled"></button><button data-name="save" id="codesign-save-button" title="Open in new window as image" class="codesign-save last"></button></div><div class="codesign-dropdown" id="codesign-brushes" style="display:none"><% for (var i in brushes) { %><% if(brushes.hasOwnProperty(i)) { %><button data-name="<%=i%>" class="button"><span class="codesign-brush-<%=i%>">&nbsp;</span><%=brushes[i].name%></button><%} %><%} %></div><div class="codesign-dropdown" id="codesign-colors" style="display:none"><div class="codesign-left-col"><div id="codesign-color-picker"></div><span class="codesign-middle-text">or</span></div><div class="codesign-right-col"><% for (var i in colors) { %><% if(colors.hasOwnProperty(i)) { %><button data-name="<%=i%>" class="button"><span class="codesign-color-<%=i%>">&nbsp;</span><%=colors[i].name%></button><%} %><%} %></div></div><div class="codesign-dropdown" id="codesign-sizes" style="display:none"><button data-value="1" class="button"><span class="codesign-size-1">&nbsp;</span>Small</button><button data-value="16" class="button"><span class="codesign-size-16">&nbsp;</span>Medium</button><button data-value="32" class="button last"><span class="codesign-size-32">&nbsp;</span>Large</button></div><div class="codesign-dropdown" id="codesign-save" style="display:none"><div class="codesign-image"><img src="" id="codesign-image" /></div><p class="codesign-save-message">To save, right click on the above image, and then select "Save Image As".</p><button class="codesign-save-okay-button">Okay, I\'m done</button></div>');
b.coDesign.CanvasControl=function(a){this.painter=a.painter;this.writer=a.writer;this.brushes=a.brushes||{};this.colors=a.colors||{};this.sizes=a.sizes||[1,16,32];this.$context=a.$context;this.canvas=a.canvas;this.defaultColor=a.defaultColor||"#900";this.defaultBrush=a.defaultBrush||{};e(this)};b.coDesign.CanvasControl.prototype={};var d={}})(jQuery);(function(){function b(c,b){if(b.brush&&b.color){var i=c.canvas.getContext("2d"),d=b.brush,a=b.x,f=b.y,g=d.size,l=d.pointsPerLayer,j=d.spin,h=d.layers>=g?g:d.layers,m=Math.floor(g/h)||1;i.lineWidth=d.lineWidth;i.strokeStyle=typeof b.color==="string"?b.color:"rgba("+b.color.r+","+b.color.g+","+b.color.b+","+(d.pressure.softness||1)+")";i.beginPath();do e({centerX:a,centerY:f,radiusX:g*d.heightRatio,radiusY:g*d.widthRatio,spin:d.randomizeSpin?Math.floor(Math.random()*(d.spinDegree+1))/360:j,steps:d.randomizePoints?
Math.floor(Math.random()*l+1):l,layers:h,drawMethod:function(a,b,e){var g=d.connectLines!==!1,f={};if(d.pressure.randomize)i.lineWidth=Math.floor(Math.random()*(d.lineWidth+1));c.points[h]||(c.points[h]=[]);!c.points[h][a]||!g?(f.x=b-1,f.y=e-1):(f.x=c.points[h][a].x,f.y=c.points[h][a].y);c.points[h][a]={x:b,y:e};i.moveTo(f.x,f.y);i.lineTo(b,e)}}),g-=m,h--;while(h);i.stroke()}}function e(c){var b=c.centerX,e=c.centerY,d=c.radiusX,a=c.radiusY,f=c.steps,g=c.drawMethod,l,j,h,m;l=c.spin*2*Math.PI;var c=
Math.sin(l),k=Math.cos(l);j=b+k*d;h=e+c*a;for(l=1;l<=f;l++)j=l/f*2*Math.PI,h=Math.sin(j),m=Math.cos(j),j=b+(d*m*k-a*h*c),h=e+(d*m*c+a*h*k),g(l,j,h)}var g=1;$.coDesign.CanvasDraw=function(c){this.id=g++;this.canvas=c.canvas;this.size=c.size;this.updateColor(c.color||{});this.updateBrush(c.brush||{});this.erase=this.isActive=!1;this.points=[]};$.coDesign.CanvasDraw.prototype={begin:function(){this.isActive=!0;return this},complete:function(){this.isActive=!1;this.points=[];return this},draw:function(c){var e,
i;if(!this.isActive)return this;if(this.erase)return this.canvas.getContext("2d").clearRect(c.x-this.size/2,c.y-this.size/2,this.size,this.size),this;this.color=e=c.color||(!this.colors?this.color:this.colors.next());if(!(i=c.brush))this.brushReverse?this.brushCyclePos===0?(i=1,this.brushReverse=!1):(i=-1,this.brushReverse=!0):this.brushCyclePos===this.brushLength?(i=-1,this.brushReverse=!0):(i=1,this.brushReverse=!1),i=this.brushes[this.brushCyclePos+=i];c={x:c.x,y:c.y,color:e,brush:i};this.brush=
i;b(this,c);return this},updateColor:function(c){typeof c==="string"?(this.colorOptions={},this.color=c,this.colors=null):(this.colorOptions=c||{},this.colors=new $.coDesign.ColorArray(this.colorOptions))},updateBrush:function(c){if(c)this.brushOptions=c;for(var c=this.brushOptions,b=this.size,e=0,d=c.len||4,a=c.spin/360||20/360,f=c.points||7,g=c.layers||4,l=c.size||{max:0.5,min:null,wave:null},j=Math.ceil(b*(l.min||0.1)),h=Math.ceil(b*(l.max||0.1)),m=c.pressure||{max:4,min:2,wave:0.3},k=[],n,r;e++<
d;)n=l.wave&&j?Math.ceil(Math.sin(l.wave*e)*j+h):b,r=m.wave&&m.max?Math.sin(m.wave*e)*m.max+m.min:m.max||2,k.push({layers:g,pointsPerLayer:f,lineWidth:r,size:n,spinDegree:c.spin,spin:a,widthRatio:c.widthRatio||1,heightRatio:c.heightRatio||1,radiusOpts:l,pressure:m,connectLines:c.connectLines,randomizeSpin:c.randomizeSpin,randomizePoints:c.randomizePoints});this.brushes=k;this.brushLength=this.brushes.length;this.brushCyclePos=0;this.brushReverse=!1},setErase:function(b){this.erase=b===void 0?!0:b}}})();(function(){$.coDesign.CanvasWrite=function(b){this.canvas=b.canvas;this.fontStyle="bold";this.fontSize=b.fontSize||16;this.fontFamily="sans-serif";this.baseline="top";this.color=b.color||"#fff";this.align="left";this.left=this.top=0;this.lastCharacters=[]};$.coDesign.CanvasWrite.prototype={begin:function(b){var e=this.canvas.getContext("2d");this.lastCharacters=[];this.top=b.top;this.left=this.beginLeft=b.left;this.color=b.color||this.color;e.font=this.fontStyle+" "+this.fontSize+"px "+this.fontFamily;
e.textBaseline="middle";e.globalAlpha=0.9},draw:function(b){var e=this.canvas.getContext("2d"),g=e.measureText(b).width,c;try{c=e.getImageData(this.left,this.top-this.fontSize/2,g,this.fontSize)}catch(o){}this.lastCharacters.push({top:this.top,left:this.left,height:this.fontSize,width:g,imageData:c});c=this.color;typeof c!=="string"&&(c=c.next(),c="rgba("+c.r+","+c.g+","+c.b+",.8)");e.fillStyle=c;e.fillText(b,this.left,this.top);this.left+=g},backspace:function(){var b=this.canvas.getContext("2d"),
e;if(this.lastCharacters.length!==0){e=this.lastCharacters.pop();try{b.putImageData(e.imageData,e.left,e.top-e.height/2)}catch(g){}this.left-=e.width}},newline:function(){this.top+=this.fontSize;this.left=this.beginLeft},updateColor:function(b){this.color=typeof b==="string"?[b]:new $.coDesign.ColorArray(b)}}})();(function(){function b(b){var g=b.frequencyR||0.1,c=b.frequencyG||0.1,o=b.frequencyB||0.1,i=b.phaseR||0.1,d=b.phaseG||0.1,a=b.phaseB||0.1,f=b.alpha||0.3,q=b.center||200,l=b.width||100,b=b.len||50,j=[],h,m,k,n;for(n=0;++n<b;)h=Math.sin(g*n+i)*l+q,m=Math.sin(c*n+d)*l+q,k=Math.sin(o*n+a)*l+q,j.push({r:Math.floor(h),g:Math.floor(m),b:Math.floor(k),a:f});return j}$.coDesign.ColorArray=function(e){var g=b(e),c=0,o=!1,i=g.length;g.next=function(){var b;o?c===0?(b=1,o=!1):(b=-1,o=!0):c===i-1?(b=-1,o=!0):
(b=1,o=!1);return g[c+=b]};return g}})();(function(b){function e(b){for(var c in b)if(b.hasOwnProperty(c)&&b[c]["default"])return b[c].realName=c,b[c]}var g={},c={},o={brushes:b.coDesign.brushes,colors:b.coDesign.colors,color:"#b33",brushSize:2,height:null,width:null,fullScreen:!1,onDraw:function(){},onWrite:function(){},enableControls:!0};b.fn.coDesign=function(i,d){this.each(function(){var a=b(this),f,q,l,j,h,m,k,n,r,s,p;if(typeof i==="string")return a.trigger({type:i+".rainbow",options:d}),a;a=b(this);f=b.extend({},o,i||{});q=f.width||
a.width();l=f.fullScreen?b(window).height():f.height||a.height();j=b('<canvas class="codesign-canvas" width="'+q+'" height="'+l+'" />').appendTo(a);if(!j.get(0).getContext||!j.get(0).getContext("2d"))return alert("coDesign.js will not work for you.  Your browser does not support HTML5 canvas.  Please consider upgrading your browser."),!1;h=a.position();s=e(f.brushes);p={init:function(){var c=j.get(0).getContext("2d");c.fillStyle="#fff";c.fillRect(0,0,q,l);j.mousedown(function(a){a.preventDefault()});
k=new b.coDesign.CanvasDraw({canvas:j.get(0),color:f.color,size:f.brushSize,brush:b.extend({},s)||{}});n=new b.coDesign.CanvasWrite({canvas:j.get(0),color:f.color});r=b('<textarea style="position:absolute;"></textarea>').prependTo(a);r.bind("keyup",p.textareaKeyUp);f.enableControls&&p.enableControls()},textareaKeyUp:function(a){a.keyCode===8?(a="backspace",n.backspace()):a.keyCode===13?(a="newline",n.newline()):(a="complete",n.draw(this.value));f.onWrite({action:a,value:this.value,color:n.color});
this.value=""},enableControls:function(){new b.coDesign.CanvasControl({canvas:j.get(0),brushes:f.brushes,colors:f.colors,painter:k,writer:n,$context:a,defaultColor:f.color,defaultBrush:s})},mouseUp:function(a){var b=a.clientY+window.pageYOffset-h.top,a=a.clientX+window.pageXOffset-h.left;n.begin({top:b,left:a});f.onWrite({action:"begin",top:b,left:a,color:n.color});r.focus();clearInterval(m);k.complete();f.onDraw({type:"push-paint",action:"complete"})},mouseDown:function(a){var b=a.clientX+window.pageXOffset-
h.left,c=a.clientY+window.pageYOffset-h.top;k.begin();f.onDraw({type:"push-paint",action:"begin"});m=setInterval(function(){k.draw({x:b,y:c});if(k.brush&&k.color)f.onDraw({action:"incomplete",brush:k.brush,color:k.color,x:b,y:c})},100)},mouseMove:function(a){if(k.isActive){var b=a.clientX+window.pageXOffset-h.left,a=a.clientY+window.pageYOffset-h.top;clearInterval(m);k.draw({x:b,y:a});if(k.isActive&&k.brush&&k.color)f.onDraw({action:"incomplete",brush:k.brush,color:k.color,x:b,y:a})}},paint:function(a){var a=
a.options,d=a.action,e=a.clientId,f;d&&e&&((f=c[e])||(f=c[e]=new b.coDesign.CanvasDraw({canvas:j.get(0)})),d==="begin"?f.begin(a):d==="complete"?f.complete():d==="incomplete"&&f.draw({color:a.color,x:a.x,y:a.y,brush:a.brush}))},write:function(a){var a=a.options,c=a.action,d=a.clientId,e;c&&d&&((e=g[d])||(e=g[d]=new b.coDesign.CanvasWrite({canvas:j.get(0)})),c==="begin"?e.begin({top:a.top,left:a.left,color:a.color}):c==="complete"?e.draw(a.value):c==="newline"?e.newline():c==="backspace"&&e.backspace())}};
p.init();var t;b(document.body).bind("mousedown touchstart",function(){t=!0}).bind("mouseup touchend",function(){t=!1});j.bind("mouseleave",function(a){p.mouseUp(a)}).bind("mouseenter",function(a){t&&(!a.fromElement||a.fromElement.tagName!=="BUTTON")&&p.mouseDown(a)}).bind("mouseup touchend",p.mouseUp).bind("mousedown touchstart",p.mouseDown).bind("mousemove touchmove",p.mouseMove);return a.bind("paint.rainbow",p.paint).bind("write.rainbow",p.write)})}})(jQuery);
